!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e,t){c[e]=t}function t(e,t,n){var i=t;return n.map(function(t){i=t(e)(i)}),i}function n(e,t,n){var i=t;return n.map(function(t){i=t(e)(i)}),i}function i(){var e;return(e=window._LIZHIJS).ajax.apply(e,arguments)}function o(){var e=this;L.bridge?r.call(e):document.addEventListener("LizhiJSBridgeReady",function(){P("bridge",window.LizhiJSBridge),r.call(e)},!1)}function r(){var e=this,t=e.option,n=t.url,i=t.eventList;e.emit("bridge:ready",L.bridge),i.map(function(t){A.on(t,function(n){e.emit(t,n)})}),n?a.call(e,n,function(t){e.isReady=!0,e.emit("signed",t),e.emit("ready")}):(e.isReady=!0,e.emit("ready"))}function a(e,t){var n=this,o=[];A.call("getUdid",{},function(r){if(o.push(r),"success"===r.status){var a=r.udid;n.emit("sign",{status:"success",data:{step:"getUdid",ret:r,rets:o},msg:"success"}),i({url:e,data:{udid:a},dataType:"json",success:function(e){o.push(e),0===e.rCode?(n.emit("sign",{status:"success",data:{step:"getSign",ret:e,rets:o},msg:"success"}),A.call("requestVerifySign",e.data,function(e){o.push(e),"success"===e.status?(n.emit("sign",{status:"success",data:{step:"requestVerifySign",ret:e,rets:o},msg:"success"}),n.once("verifySignFinish",function(e){o.push(e),"success"===e.status?(n.emit("sign",{status:"success",data:{step:"verifySignFinish",ret:e,rets:o},msg:"success"}),t(o)):n.emit("sign",{status:"failed",data:{step:"verifySignFinish",ret:e,rets:o},msg:"failed"})})):n.emit("sign",{status:"failed",data:{step:"requestVerifySign",ret:e,rets:o},msg:"failed"})})):n.emit("sign",{status:"failed",data:{step:"getSign",ret:e,rets:o},msg:"failed"})},error:function(e){o.push(e),n.emit("sign",{status:"failed",data:{step:"getSign",ret:e,rets:o},msg:"failed"})}})}else n.emit("sign",{status:"failed",data:{step:"getUdid",ret:r,rets:o},msg:"failed"})})}var s=window.navigator.userAgent,u=window.LizhiJSBridge,c={bridge:u,isApp:!!(s.indexOf("LizhiFM")>=0||u)},d={state:c,update:e},f=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),g=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},p=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v={},h=0,m=function(){function e(){f(this,e)}return l(e,[{key:"on",value:function(e,t){return e in v||(v[e]={}),v[e][++h]=t,h}},{key:"off",value:function(e,t){e in v&&t in v[e]&&delete v[e][t]}},{key:"emit",value:function(e){if(e in v){for(var t=v[e],n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];for(var r in t)t[r].apply(null,i)}}},{key:"once",value:function(e,t){var n=this.on,i=this.off,o=n(e,function(n){t(n),i(e,o)});return o}}]),e}(),y=function(e){return function(t){return function(n,i,o){e.isApp&&t(n,i,o)}}},w=function(e){return function(t){return function(n,i,o){t(n,i,function(t){e.option.debug&&e.alt({api:n,ret:t}),o(t)})}}},b=function(e){return function(t){return function(n,i){t(n,function(t){e.option.debug&&e.alt({event:n,ret:t}),i(t)})}}},S=function(e){return function(e){return function(t,n,i){return i?e(t,n,i):new Promise(function(i,o){e(t,n,function(e){return i(e)})})}}},L=d.state,P=d.update,A={call:function(e,t,n){L.bridge.call(e,t,n)},on:function(e,t){L.bridge.on(e,t)}},k=function(e){function i(){f(this,i);var e=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.isReady=!1,e.isApp=d.state.isApp,e}return g(i,e),l(i,[{key:"config",value:function(e){var i=e.debug,r=void 0!==i&&i,a=e.url,s=void 0===a?"":a,u=e.apiList,c=void 0===u?[]:u,d=e.eventList,f=void 0===d?[]:d,l=e.apiMiddlewares,g=void 0===l?[]:l,p=e.eventMiddlewares,v=void 0===p?[]:p,h=e.other,m=void 0===h?{}:h,L=this;L.option={debug:r,url:s,apiList:c,eventList:f,apiMiddlewares:g,eventMiddlewares:v,other:m},s&&![!1].concat(f).reduce(function(e,t){return e||"verifySignFinish"===t})&&f.push("verifySignFinish");var P=[y,w].concat(g,[S]),k=[b].concat(v);A.call=t(L,A.call,P),A.on=n(L,A.on,k),c.map(function(e){L[e]=function(t,n){return A.call(e,t,n)}}),o.call(L)}},{key:"ready",value:function(e){var t=this;t.isReady?e():t.on("ready",function(){e()})}},{key:"alt",value:function(e){window.alert(JSON.stringify(e))}},{key:"log",value:function(){var e;L.isApp&&L.bridge&&(e=L.bridge).log.apply(e,arguments)}}]),i}(m),O=new k,C="https://link.lizhi.fm/ulink/action/?action=",R={iPhone:!!navigator.userAgent.toLowerCase().match("iphone"),iPod:!!navigator.userAgent.toLowerCase().match("ipod"),iPad:!!navigator.userAgent.toLowerCase().match("ipad"),android:navigator.userAgent.toLowerCase().indexOf("android")>-1,qqBrowser:window.navigator.userAgent.indexOf("MQQBrowser")>-1,quarkBrowser:window.navigator.userAgent.indexOf("Quark")>-1,wx:/MicroMessenger/i.test(window.navigator.userAgent),qq:/QQ\//i.test(window.navigator.userAgent),lz:/lizhifm/i.test(window.navigator.userAgent),weibo:window.navigator.userAgent.toLowerCase().indexOf("weibo")>-1},j=function(e){return"[object Object]"===Object.prototype.toString.call(e)},q=function(e){return e&&j(e)?Object.keys(e).reduce(function(t,n){return t?t+"&"+n+"="+e[n]:n+"="+e[n]},""):""},F=function(e){var t=e.normalFn,n=e.abnormalFn;t();var i="",o="",r=!1,a=document;void 0!==a.hidden?(i="hidden",o="visibilitychange"):void 0!==a.msHidden?(i="msHidden",o="msvisibilitychange"):void 0!==a.webkitHidden&&(i="webkitHidden",o="webkitvisibilitychange"),void 0===document.addEventListener||void 0===document[i]?console.log("不支持visibilitychange"):document.addEventListener(o,function(){document[i]&&(r=!0)},!1);var s=setTimeout(function(){r?clearTimeout(s):n()},2e3)},I=function(e,t){console.log("evoke v0.1.7");var n=encodeURIComponent(JSON.stringify(e)),i={};t&&t.cmdToken&&(i.t=t.cmdToken),t&&t.downloadUrl&&(i.downloadUrl=encodeURIComponent(t.downloadUrl));var o=q(i),r=o?n+"&"+o:n,a=function(){window.location.href=n?C+r:"https://link.lizhi.fm/ulink"};if(R.wx||R.qq)return void a();if(R.quarkBrowser)window.location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.yibasan.lizhifm";else if(R.iPhone||R.iPad)a();else if(R.android){if(R.weibo){var s=document.createElement("a");return s.href=C+r,s.setAttribute("download","lizhi"),document.body.appendChild(s),s.click(),void document.body.removeChild(s)}F({normalFn:function(){window.location.href=n?"lizhifm://action?action="+n:"lizhifm://"},abnormalFn:function(){a()}})}else F({normalFn:function(){a()},abnormalFn:function(){a()}})},M=["getToken","getAppInfo","getSessionUser","shareUrl","playProgram","scanUser","showOrHideBottomPlayer","gotoLogin","showCommentMenu","showOrHideBottomInput","downloadMaterial","getDownloadMaterialStatus","isSupportFunc","closeWebView","scanRechargeCenter","toAction","getWebDisplayInfo","setAppDisplayInfo","startRecordVoice","stopRecordVoice","shareImage","showGivePresent","reportEvent","getUdid","requestVerifySign","requestBuyProduct","requestTradeProduct","getSupportedPaymentTypeList","saveImage","configShareUrl","replayRecordVoice","uploadRecordVoice","updateHotProgressVisible","gotoRegister","shareImageUrl","selectedSong","getSelectedSongStatus","configNativeLivePK","showPrompt","showAlert","phoneRiskResult","popupLiveGiftDialog","stopAllAudioPlay","bindThreePartyPlatform","webTraceReport","holdLocks","getValidCdnHost","realWidgetsLayoutChanged","playSoundEffect","requestReportAction","openSystemPermissionSetting","getABTestConfig","getAppId","updateUserInfo","getPageInfo","getBusinessVerifyState","getMyVerifyState","startBusinessVerifyProcess","fVIPBuyResult","requestKlmMakeProduct","fVIPKeyboardInput","requestKlmMakeOrder","showVoicePayDialog","updateAfterUserSelectedCouponByH5"],V=["user:login","comment:success","downloadMaterial:status","hitsTrade","visible","recordStateChange","givePresentSuccess","verifySignFinish","buyProductFinish","payFinish","tradeProductFinish","updateLivePKInfo","selectedSong:status","shareFinish","nativeLayoutChanged","onKlmReceiptResult","onKlmMakeOrderResult"],z=function(e){return"[object Object]"===Object.prototype.toString.call(e)},B=function(e){e.forEach(function(e){var t=O[e];O[e]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=e[0],o=e[1],r=e[2];return new Promise(function(e,n){if(!/LizhiFM/i.test(window.navigator.userAgent.toLocaleLowerCase())){if(o){if(!z(o))return void n("action必须为object");if(r){if(!z(r))return void n("options必须为object");I(o,r)}else I(o)}return void n("请在荔枝APP内调用")}O.ready(function(){t.call(O,i).then(function(t){e(t)}).catch(function(e){n(e)})})})}})};!function(){var e=window._lzConfigOption,t=e&&Array.isArray(e.apiList)&&e.apiList,n=e&&Array.isArray(e.eventList)&&e.eventList,i={debug:!(!e||void 0===e.debug)&&e.debug,url:e&&void 0!==e.url?e.url:"//h5security.lizhifm.com/jsBridgeConfig/get",apiList:t?M.concat(t):M,eventList:n?V.concat(n):V};O.config(i),B(i.apiList),window.lz=O}()});
